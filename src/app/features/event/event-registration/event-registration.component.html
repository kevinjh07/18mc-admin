<mat-toolbar>
  {{ event.id == null ? "Cadastrar Evento" : "Editar Evento" }}
</mat-toolbar>

<div class="container" fxLayout="row" fxLayoutAlign="center none">
  <div fxFlex="95%">
    <form class="mt-10" [formGroup]="formGroup" (ngSubmit)="save()">
      <mat-tab-group mat-stretch-tabs="false" mat-align-tabs="start">
        <mat-tab label="Dados do evento">
          <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="20px" style="margin-top: 2%">
            <mat-form-field [fxFlex]="50">
              <input
                matInput
                placeholder="Título"
                type="text"
                formControlName="title"
                [(ngModel)]="event.title"
                maxlength="150"
                required
              />
              <mat-error *ngIf="formGroup.controls['title'].invalid">Campo obrigatório</mat-error>
            </mat-form-field>
          </div>

          <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="20px">
            <mat-form-field [fxFlex]="50">
              <input
                matInput
                [matDatepicker]="date"
                placeholder="Data"
                formControlName="date"
                [(ngModel)]="event.date"
                (click)="date.open()"
                required
              />
              <mat-datepicker-toggle matSuffix [for]="date"> </mat-datepicker-toggle>
              <mat-datepicker #date></mat-datepicker>
              <mat-error *ngIf="formGroup.controls['date'].invalid">Campo obrigatório</mat-error>
            </mat-form-field>
          </div>

          <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="20px">
            <mat-form-field [fxFlex]="50">
              <mat-select
                formControlName="commandId"
                placeholder="Selecione o comando"
                (selectionChange)="getRegionals(); event.regionalId = 0; event.divisionId = 0"
                [(ngModel)]="selectedCommandId"
                required
              >
                <mat-option *ngFor="let command of commands" [value]="command.id">
                  {{ command.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="20px">
            <mat-form-field [fxFlex]="50">
              <mat-label>Regional</mat-label>
              <mat-select
                formControlName="regionalId"
                [(ngModel)]="event.regionalId"
                (selectionChange)="getDivisions()"
                required
              >
                <mat-option *ngFor="let regional of regionals" [value]="regional.id">{{ regional.name }}</mat-option>
              </mat-select>
              <mat-error *ngIf="formGroup.controls['regionalId'].invalid">Campo obrigatório</mat-error>
            </mat-form-field>
          </div>

          <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="20px">
            <mat-form-field [fxFlex]="50">
              <mat-label>Divisão</mat-label>
              <mat-select formControlName="divisionId" [(ngModel)]="event.divisionId" required>
                <mat-option *ngFor="let division of divisions" [value]="division.id">{{ division.name }}</mat-option>
              </mat-select>
              <mat-error *ngIf="formGroup.controls['divisionId'].invalid">Campo obrigatório</mat-error>
            </mat-form-field>
          </div>

          <div fxLayout="row" fxLayout.lt-md="column" fxLayoutGap="20px">
            <mat-form-field [fxFlex]="100">
              <textarea
                matInput
                placeholder="Descrição"
                formControlName="description"
                [(ngModel)]="event.description"
                [maxLength]="1000"
                cols="40"
                rows="7"
              ></textarea>
              <mat-hint align="end">{{ event.description.length }} / 1000</mat-hint>
            </mat-form-field>
          </div>
        </mat-tab>

        <mat-tab *ngIf="event.id" label="Participantes">
          <div style="margin-top: 2%">
            <dual-list
              [source]="availablePerson"
              [(destination)]="selectedPerson"
              [format]="format"
              [key]="'id'"
              [display]="'shortName'"
            ></dual-list>
          </div>
        </mat-tab>
      </mat-tab-group>

      <div class="action-buttons">
        <button mat-flat-button color="primary">
          <mat-icon>save</mat-icon>
          Salvar
        </button>
        <button mat-flat-button type="button" [routerLink]="['/event']">
          <mat-icon>close</mat-icon>
          Cancelar
        </button>
      </div>
    </form>
  </div>
</div>
